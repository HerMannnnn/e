<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>数据查询</title>
    <meta name="keywords" content="数据查询">
    <meta name="description" content="数据查询">

    <link rel="shortcut icon" href="favicon.ico"> <link href="css/bootstrap.min.css?v=3.3.6" rel="stylesheet">
    <link href="css/font-awesome.css?v=4.4.0" rel="stylesheet">
	
	<link href="css/plugins/chosen/chosen.css" rel="stylesheet">
	<!-- Data Tables -->
	<link href="css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">

    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css?v=4.1.0" rel="stylesheet">
	<style>
		.chosen-select{
			width: 150px;
			
		}
		.input-group
		{
			float: left;
			margin-left: 20px;
			
		}
		.form-group
		{
			margin-bottom: 30px;
		}
		
		.form-group .font-noraml
		{
			float: left;	
		}
		.layer-date
		{
			max-width: 200px;
			float: left;
		}
		.btn-primary
		{
			margin-left: 20px;;
		}
	</style>

</head>

<body class="gray-bg">
    <!--<div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-sm-4">
            <h2>数据查询</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="index.html">治超数据</a>
                </li>
                <li>
                    <strong>数据查询</strong>
                </li>
            </ol>
        </div>
        <div class="col-sm-8">
            <div class="title-action">
                <a href="empty_page.html" class="btn btn-primary">活动区域</a>
            </div>
        </div>
    </div>-->

    <div class="wrapper wrapper-content">

        <div class="row">
			
            <div class="col-sm-12">
                
				<div class="ibox float-e-margins">
					<div class="ibox-content">
						<div class="form-group">
							<!-- <label class="font-noraml">选择区域</label> -->
							<label class="col-sm-2 control-label">选择站点：</label>
							<div class="input-group">
								<select data-placeholder="选择省份..." class="chosen-select"  tabindex="2" id="select_province" onchange="load_region_next(2)">
									<option value="">请选择省份</option>
								</select>
							</div>
							<div class="input-group">
								<select data-placeholder="选择市..." class="chosen-select" tabindex="2"  id="select_city" onchange="load_region_next(3)">
									<option value="">请选择市</option>
								</select>
							</div>
							<div class="input-group">
								<select data-placeholder="选择县区..." class="chosen-select" tabindex="2" id="select_county"  onchange="load_region_next(4)">
									<option value="">请选择县、区</option>
								</select>
							</div>
							<div class="input-group">
								<select data-placeholder="选择站点..." class="chosen-select"  tabindex="2" id="select_station" onchange="load_region_next(5)">
									<option value="">请选择站点</option>
								</select>
							</div>
						</div>
					</div>
					<!--<div class="ibox-content">
						<div class="form-group">
							&lt;!&ndash; <label class="font-noraml">选择区域</label> &ndash;&gt;
							<label class="col-sm-2 control-label">查询范围：</label>
							<div class="input-group">
								<select data-placeholder="请车道编号..." class="chosen-select"  tabindex="2" id="select_lane">
									<option value="">请车道编号</option>
									<option value="51" hassubinfo="true">51</option>
									<option value="52" hassubinfo="true">52</option>
									<option value="53" hassubinfo="true">53</option>
								</select>
							</div>
							<div class="input-group">
								<select data-placeholder="请选择轴数..." class="chosen-select" tabindex="2" id="select_axis">
									<option value="">请选择轴数</option>
									<option value="8" hassubinfo="true">8</option>
									<option value="9" hassubinfo="true">9</option>
									<option value="10" hassubinfo="true">10</option>
								</select>
							</div>
							<div class="input-group">
								<input type="text" placeholder="请输入车牌号" class="form-control" style="width: 150px;" id="veh_plate">
							</div>
							<div class="input-group">
								<select data-placeholder="请选择重量标志..." class="chosen-select"  tabindex="2" id="select_weight">
									<option value="">请选择重量标志</option>
									<option value="110000" hassubinfo="true">重量标志1</option>
									<option value="110000" hassubinfo="true">重量标志2</option>
								</select>
							</div>
							<div class="input-group">
								<select data-placeholder="请选择宽高标志..." class="chosen-select"  tabindex="2" id="select_height">
									<option value="">请选择宽高标志</option>
									<option value="110000" hassubinfo="true">宽高标志1</option>
									<option value="110000" hassubinfo="true">宽高标志2</option>
								</select>
							</div>
						</div>
					</div>-->
					<div class="ibox-content">
						<div class="form-group">
							<label class="col-sm-2 control-label">请选择起止时间：</label>
							<div class="col-sm-10">
								<input placeholder="开始日期" class="form-control layer-date" id="start">


								<button class="btn btn-primary " type="button" onclick="get_record()">查询</button>

							</div>
						</div>
					</div>
				</div>
                
            </div>
        </div>
		<div class="row">
		            <div class="col-sm-12">
		                <div class="ibox float-e-margins">
		                    <!--<div class="ibox-title">
		                        <h5>数据表格 <small>分类，查找</small></h5>
		                        <div class="ibox-tools">
		                            <a class="collapse-link">
		                                <i class="fa fa-chevron-up"></i>
		                            </a>
		                        </div>
		                    </div>-->
		                    <div class="ibox-content">
		
		                        <table class="table table-striped table-bordered table-hover dataTables-example" id="editable">
		                            <thead>
										<th>站点名称</th>
										<th>车牌号码</th>
										<th>轴数</th>
										<th>轴型</th>
										<th>总重</th>
										<th>限重</th>
										<th>超重</th>
										<th>超载率</th>
										<th>称重时间</th>
		                            </thead>
		                            <tbody>

		                            </tbody>
		                            
		                        </table>
		
		                    </div>
		                </div>
		            </div>
		        </div>
	</div>

    <!-- 全局js -->
    <script src="js/jquery.min.js?v=2.1.4"></script>
    <script src="js/bootstrap.min.js?v=3.3.6"></script>

    <!-- 自定义js -->
    <script src="js/content.js?v=1.0.0"></script>

	<!-- Chosen -->
	<script src="js/plugins/chosen/chosen.jquery.js"></script>
	
	<script src="js/plugins/jeditable/jquery.jeditable.js"></script>
	<!-- Data Tables -->
	<script src="js/plugins/dataTables/jquery.dataTables.js"></script>
	<script src="js/plugins/dataTables/dataTables.bootstrap.js"></script>
	
	<!-- layerDate plugin javascript -->
    <script src="js/plugins/layer/laydate/laydate.js"></script>
	<script src="js/plugins/layer/layer.min.js"></script>
	
	<script src="js/sxsh/sxsh-common.js"></script>
	<!-- Page-Level Scripts -->
	    <script>
	        $(document).ready(function () {
				$('.dataTables-example').dataTable();
				/* Init DataTables */
				var oTable = $('#editable').dataTable();
				load_region(0,1);
	        });

			laydate.render({
				elem: '#start',
				type: 'date',
				range: '~'
			});

			function load_region(parent_id,order_id)
			{
				$.ajax({
					url: '<?=base_url()?>index.php?c=record&m=load_region&parent_id='+parent_id+'&order_id='+order_id,
					type: 'GET',
					dataType: 'json',
					success: function (data) {
						//console.log(data);
						if(data.code==1)
						{
							var str="";
							var ary=data.data;
							for(var i=0;i<ary.length;i++)
							{
								str+="<option value="+ary[i].regionid+" hassubinfo='true'>"+ary[i].name+"</option>";
							}
							if(order_id==1)
							{
								$("#select_province").append(str);
								//$("#select_province").chosen("destroy");
								$("#select_province").trigger("chosen:updated");
							}
							else if(order_id==2)
							{
								$("#select_city").append(str);
								$("#select_city").trigger("chosen:updated");
							}
							else if(order_id==3)
							{
								$("#select_county").append(str);
								$("#select_county").trigger("chosen:updated");
							}
							else if(order_id==4)
							{
								$("#select_station").append(str);
								$("#select_station").trigger("chosen:updated");

							}
						}
					},
					error:function(data)
					{
						console.log(data);
					}
				});
			}

			function load_region_next(flag)
			{
				var parent_id;
				if(flag==2)
				{
					parent_id=$("#select_province").val();
					$("#select_city").empty();
					$("#select_city").append("<option>请选择市</option>");
					$("#select_city").trigger("chosen:updated");

					$("#select_county").empty();
					$("#select_county").append("<option>请选择县、区</option>");
					$("#select_county").trigger("chosen:updated");

					$("#select_station").empty();
					$("#select_station").append("<option>请选择站点</option>");
					$("#select_station").trigger("chosen:updated");
				}
				else if(flag==3)
				{

					$("#select_county").empty();
					$("#select_county").append("<option>请选择县、区</option>");
					$("#select_county").trigger("chosen:updated");

					$("#select_station").empty();
					$("#select_station").append("<option>请选择站点</option>");
					$("#select_station").trigger("chosen:updated");
					//$("#select_couty").val("默认值").trigger("chosen:updated");
					parent_id=$("#select_city").val();
				}
				else if(flag==4)
				{
					$("#select_station").empty();
					$("#select_station").append("<option>请选择站点</option>");
					$("#select_station").trigger("chosen:updated");
					//$("#select_couty").val("默认值").trigger("chosen:updated");
					parent_id=$("#select_county").val();
					console.log(parent_id,flag);
				}
				else if(flag==5)
				{
					var station_id=$("#select_station").val();
					//realtime_record(123456);
				}
				load_region(parent_id,flag);
			}

			function get_record()
			{
				var station_id=$("#select_station").val();
				/*var lane=$("#select_lane").val();
				var axis=$("#select_axis").val();
				var veh_plate=$("#veh_plate").val();
				var weight=$("#select_weight").val();
				var height=$("#select_height").val();*/
				var time=$("#start").val();
				//var end_time=$("#end").val();


				if(station_id!=""&&time!="")
				{
					time=time.replace(/\s+/g,"");
					station_id='123456';
					$("#editable").dataTable( {
						/*"retrieve":true,*/
						"destroy":true,
						"ajax": "<?=base_url()?>index.php?c=record&m=load_record&station_id="+station_id+"&start_time="+time+"",
						/*"ajax": "<?=base_url()?>index.php?c=record&m=load_record&station_id="+station_id+"&lane="+lane+"&axis="+(axis==''?0:axis)+"&veh_plate=="+(veh_plate==''?0:veh_plate)+"&weight="+(weight==''?0:weight)+"&height="+(height==''?0:height)+"&start_time="+start_time+"&end_time="+end_time+"",*/
						"columns": [
							{ "data": "siteid" },
							{ "data": "vehicle_no" },
							{ "data": "axles" },
							{ "data": "siteid" },
							{ "data": "totalweight" },
							{ "data": "limitweight" },
							{ "data": "overweight" },
							{ "data": "overweightlv" },
							{ "data": "checktime" }
						]
					} );
				}
				else
				{
					layer.alert('请填写查询条件！');
				}

			}
	    </script>
</body>

</html>
